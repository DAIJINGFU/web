# 股票池模块数据说明文档

## 一、现有数据目录说明

### 1. `stockdata/stockdata/1d_1w_1m/`

**作用**：存储股票的日线、周线、月线行情数据（OHLCV）

**目录结构**：

```
1d_1w_1m/
├── 000001/
│   ├── 000001_daily.csv          # 日线未复权数据
│   ├── 000001_daily_qfq.csv      # 日线前复权数据
│   ├── 000001_daily_hfq.csv      # 日线后复权数据
│   ├── 000001_weekly.csv         # 周线数据
│   ├── 000001_weekly_qfq.csv     # 周线前复权
│   ├── 000001_monthly.csv        # 月线数据
│   └── ...
├── 000002/
└── ...
```

**数据格式**：CSV 文件，包含列：

- 日期/datetime
- 开盘/open
- 最高/high
- 最低/low
- 收盘/close
- 成交量/volume
- 成交额/amount（可选）

**用途**：

- 回测引擎加载股票价格数据
- data_loader.py 模块读取日/周/月线数据
- 支持未复权(raw)、前复权(qfq)、后复权(hfq)三种模式

---

### 2. `stockdata/stockdata/1min/`

**作用**：存储股票的分钟级行情数据

**文件命名规则**：

- 上交所：`sh600000.csv` (如 sh600010.csv)
- 深交所：`sz000001.csv` (如 sz000001.csv)
- 或带市场后缀：`600025.SH.csv`

**数据格式**：CSV 文件，包含列：

- datetime/时间（精确到分钟）
- open/开盘
- high/最高
- low/最低
- close/收盘
- volume/成交量

**用途**：

- 分钟级回测
- 高频策略开发
- 日内交易策略

---

### 3. `stockdata/stockdata/indicator/`

**作用**：存储股票的基本面指标数据

**数据格式**：CSV 文件，包含列（示例）：

- 股票代码
- 交易日期
- 开盘价、最高价、最低价、收盘价
- 昨收价、涨跌额、涨跌幅
- 成交量、成交额、换手率
- 市盈率、市盈率 TTM
- 市净率、市销率
- 股息率
- 总股本、流通股本、自由流通股本
- 总市值、流通市值

**用途**：

- 基本面分析
- 财务指标筛选
- 估值分析
- 因子研究

---

### 4. `stockdata/stockdata/基准指数数据/`

**作用**：存储用作回测基准的指数行情数据

**现有文件**：

- `000001_日.csv` - 上证指数日线数据
- `000300_日.csv` - 沪深 300 日线数据

**数据格式**：CSV 文件，包含指数的 OHLCV 数据

**用途**：

- 回测基准对比
- 计算超额收益
- 风险调整收益指标（夏普比率、信息比率等）

---

### 5. `stockdata/stockdata/深交所指数成分_20250829/`

**作用**：存储深交所各指数的成分股及权重数据（截至 2025 年 8 月 29 日）

**文件命名**：`指数代码.SZ.csv`（如 399001.SZ.csv）

**数据格式**：CSV 文件，包含列：

- 指数代码（index_code）
- 成分股票代码（component_stock_code）
- 交易日期（trade_date）
- 权重（weight）

**现有指数数量**：约 300+个深交所指数

**用途**：

- `get_index_stocks()` 函数数据源
- `get_index_weights()` 函数数据源
- 指数增强策略
- 成分股轮动策略

**重要说明**：

- ✅ 已有数据（深交所指数）
- ⚠️ 缺少上交所指数成分数据（如 000300.SH 沪深 300）
- ⚠️ 数据日期固定为 20250829，缺少历史时间序列

---

## 二、缺少的数据及补充建议

### ⚠️ 1. 上交所指数成分及权重数据

**目录建议**：`stockdata/stockdata/上交所指数成分_YYYYMMDD/`

**需要的指数**（优先级从高到低）：

- ✅ **高优先级**：

  - `000300.SH` - 沪深 300
  - `000016.SH` - 上证 50
  - `000905.SH` - 中证 500
  - `000852.SH` - 中证 1000
  - `000001.SH` - 上证指数

- ⚠️ **中优先级**：
  - `000688.SH` - 科创 50
  - `000009.SH` - 上证 380
  - `000010.SH` - 上证 180

**文件格式**：与深交所格式保持一致

```csv
指数代码,成分股票代码,交易日期,权重
000300.SH,600519.SH,20250829,3.5
000300.SH,600036.SH,20250829,2.8
...
```

**建议数据频率**：

- 月度更新（每月最后一个交易日）
- 或季度更新（每季度末）

---

### ⚠️ 2. 行业分类数据

**目录建议**：`stockdata/stockdata/行业分类/`

**分类标准**（选择一个或多个）：

- 申万行业分类（推荐）
  - 一级行业：28 个（如银行、房地产、计算机等）
  - 二级行业：104 个
  - 三级行业：227 个
- 证监会行业分类
  - 门类：19 个（如制造业、金融业等）
  - 大类：90 个
  - 中类：426 个

**文件命名**：

- 方案 1：按行业代码分文件 `I64.csv`（计算机行业）
- 方案 2：单一文件 `industry_classification.csv`（包含所有行业）

**文件格式**：

```csv
行业代码,股票代码,交易日期,行业名称,行业级别
I64,000001.SZ,20250829,计算机应用,二级
I64,300059.SZ,20250829,计算机应用,二级
...
```

**用途**：

- `get_industry_stocks()` 函数数据源
- 行业轮动策略
- 行业配置策略

---

### ⚠️ 3. 概念板块数据

**目录建议**：`stockdata/stockdata/概念板块/`

**常见概念板块**（示例）：

- 热门概念：
  - `SC0001` - 人工智能
  - `SC0002` - 新能源汽车
  - `SC0003` - 半导体芯片
  - `SC0084` - 雄安新区（聚宽示例中的代码）
  - `SC0005` - 5G 概念
  - `SC0006` - 碳中和
  - `SC0007` - 数字经济

**文件格式**：

```csv
概念代码,股票代码,交易日期,概念名称
SC0084,000651.SZ,20190410,雄安新区
SC0084,000786.SZ,20190410,雄安新区
...
```

**注意事项**：

- 概念板块成分变动频繁，需要历史时间序列
- 申万概念板块在 2014 年 2 月 21 日进行过调整
  - 之前：28 个概念
  - 之后：23 个概念
  - 历史总共：34 个

**用途**：

- `get_concept_stocks()` 函数数据源
- 主题投资策略
- 概念轮动策略

---

### ⚠️ 4. 全市场证券列表

**目录建议**：`stockdata/stockdata/stock_list/`

**需要的文件**：

- `stock.csv` - 所有股票列表
- `fund.csv` - 基金列表（可选）
- `index.csv` - 指数列表（可选）
- `etf.csv` - ETF 列表（可选）

**文件格式**：

```csv
code,display_name,name,start_date,end_date,type
000001.SZ,平安银行,PAYH,1991-04-03,,stock
600000.SH,浦发银行,PFYH,1999-11-10,,stock
...
```

**列说明**：

- `code`: 证券代码
- `display_name`: 完整名称
- `name`: 简称/拼音缩写
- `start_date`: 上市日期
- `end_date`: 退市日期（未退市为空）
- `type`: 证券类型（stock/fund/index/etf 等）

**用途**：

- `get_all_securities()` 函数数据源
- 构建全市场股票池
- 过滤退市股票
- 筛选新股

---

### ⚠️ 5. 指数成分历史数据（时间序列）

**目录建议**：`stockdata/stockdata/指数成分历史/`

**当前问题**：

- 现有数据只有单一时间点（20250829）
- 无法回溯历史时期的指数成分

**建议方案**：

**方案 1：多文件方式**（每个日期一个目录）

```
指数成分历史/
├── 20240131/
│   ├── 000300.SH.csv
│   ├── 399001.SZ.csv
│   └── ...
├── 20240229/
│   ├── 000300.SH.csv
│   └── ...
└── ...
```

**方案 2：单文件包含历史**

```csv
指数代码,成分股票代码,交易日期,权重
000300.SH,600519.SH,20240131,3.2
000300.SH,600519.SH,20240229,3.3
000300.SH,600519.SH,20240331,3.5
...
```

**建议频率**：

- 月度快照（每月最后一个交易日）
- 至少保留 3-5 年历史数据

**用途**：

- 回测时使用当时的真实成分股
- 避免前视偏差（look-ahead bias）
- 研究指数成分变化对策略的影响

---

### ⚠️ 6. 交易日历数据（已部分支持）

**目录建议**：`data/trading_calendar.csv`

**文件格式**：

```csv
date
2024-01-02
2024-01-03
2024-01-04
...
```

**用途**：

- 判断是否为交易日
- 计算交易日间隔
- 调仓周期控制

**状态**：✅ 部分支持（代码中已有加载逻辑）

---

### ⚠️ 7. 停牌数据（可选）

**目录建议**：`stockdata/stockdata/停牌数据/`

**文件格式**：

```csv
股票代码,停牌开始日期,停牌结束日期,停牌原因
000001.SZ,2024-01-10,2024-01-15,重大资产重组
...
```

**用途**：

- 过滤停牌股票
- 避免在停牌期间下单
- 提高回测真实性

---

### ⚠️ 8. ST/退市股票标记（可选）

**目录建议**：`stockdata/stockdata/st_status/`

**文件格式**：

```csv
股票代码,状态,生效日期,结束日期
000001.SZ,ST,2024-01-01,2024-06-01
000002.SZ,退市,2024-03-01,
...
```

**用途**：

- 过滤 ST 股票
- 风险控制
- 符合监管要求

---

## 三、数据优先级总结

### 🔴 高优先级（立即补充）

1. ✅ **上交所主要指数成分数据**（000300.SH 等）
2. ✅ **行业分类数据**（申万一级/二级行业）
3. ✅ **全市场股票列表**（stock.csv）

### 🟡 中优先级（尽快补充）

4. ⚠️ **概念板块数据**（主要热门概念）
5. ⚠️ **指数成分历史数据**（时间序列）

### 🟢 低优先级（可选补充）

6. ⚠️ 停牌数据
7. ⚠️ ST/退市标记
8. ⚠️ 基金/ETF 列表

---

## 四、使用示例

### 示例 1：获取沪深 300 成分股

```python
# 需要补充数据：stockdata/stockdata/上交所指数成分_20250829/000300.SH.csv

stocks = get_index_stocks('000300.XSHG')
print(f"沪深300成分股数量: {len(stocks)}")
```

### 示例 2：获取计算机行业股票

```python
# 需要补充数据：stockdata/stockdata/行业分类/I64.csv

stocks = get_industry_stocks('I64')
print(f"计算机行业股票数量: {len(stocks)}")
```

### 示例 3：获取雄安概念股票

```python
# 需要补充数据：stockdata/stockdata/概念板块/SC0084.csv

stocks = get_concept_stocks('SC0084', date='2019-04-10')
print(f"雄安概念股票数量: {len(stocks)}")
```

---

## 五、数据获取建议

### 数据来源（参考）

1. **Tushare** - 金融数据接口（需积分）
   - 指数成分：`index_weight`
   - 行业分类：`stock_basic`, `index_classify`
2. **AKShare** - 免费金融数据

   - 指数成分：`stock_zh_index_stock_*`
   - 行业分类：`stock_board_industry_*`

3. **聚宽数据** - 收费但数据质量高

   - 与本系统 API 完全兼容

4. **Wind/Choice** - 专业金融终端（收费）

### 数据更新频率建议

- 指数成分：每月更新
- 行业分类：每季度更新
- 概念板块：根据市场热点实时更新
- 股票列表：每周更新（新股上市）

---

## 六、测试数据完整性

可以使用 `stock_pool.py` 中的辅助函数检查数据状态：

```python
from backend.app import stock_pool

# 列出本地数据状态
status = stock_pool.list_local_data_status()
print(status)

# 获取可用的指数列表
indexes = stock_pool.get_available_indexes()
print(f"可用指数数量: {len(indexes)}")
print(f"部分指数: {indexes[:10]}")
```

---

## 七、常见问题

### Q1: 为什么现有数据只有深交所指数？

A: 可能是数据获取时只下载了深交所数据，需要补充上交所指数数据。

### Q2: 如何处理指数成分的历史变化？

A: 建议按月保存成分快照，或在单一文件中包含日期字段，在查询时根据日期筛选。

### Q3: 数据格式必须严格一致吗？

A: `stock_pool.py` 已做了一定的容错处理（支持中英文列名），但建议保持格式一致以提高稳定性。

---

**文档版本**: v1.0  
**更新日期**: 2025-10-08  
**维护者**: Backtest System Team
